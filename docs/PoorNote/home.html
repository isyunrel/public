<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>添加笔记 - PoorNote</title>
    <link rel="stylesheet" href="./css/global.css">
    <link rel="stylesheet" href="./css/font-awesome.min.css">
    <link rel="stylesheet" href="./css/home.css">
</head>

<body>

    <div id="login__tip">
        您当前尚未登录，如果想进行更多操作，请<a href="./login.html">登录</a>
    </div>
    <header class="header">
        <div class="box-inner">
            <div class="header__logo">
                <a href="./index.html">PoorNote</a>
            </div>

            <div class="header__search">
                <input id="search__text" type="text" placeholder="搜索笔记">
                <i id="search__btn" class="fa fa-search"></i>
            </div>

            <a class="login__btn" href="./login.html">登录</a>
            
            <div id="user">
                <a href="./home.html">
                    <img id="user__head" src="./src/head.jpg" alt="userhead哈哈哈">
                </a>
                <div class="user__options">
                    <a href="home.html">个人主页</a>
                    <a id="logOut" href="javascript:">登出</a>
                </div>
            </div>

            <nav class="header__nav">
                <ul>
                    <li><a href="./index.html"><i class="fa fa-home"></i> 首页</a></li>
                    <li><a href="./write.html"><i class="fa fa-won"></i> 书写</a></li>
                    <li><a href="./about.html"><i class="fa fa-info"></i> 关于</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="main__info">
        <div class="box-inner">
            <img class="head__img" src="./src/head.jpg" alt="">
            <h2 class="head__name"></h2>
        </div>
    </div>

    <div class="info box-inner">
        <ul class="info__tab">
            <li class="act">笔记</li>
            <li>设置</li>
        </ul>

        <ul class="info__pages">
            <li class="act">
                <div class="note__list">
                    <div class="note">
                        <div class="color__block">
                            <b class="title">这里是文章标题这里是文章标题这里是文章标题这里是文章标题</b>
                            <p class="content">这里是文章标题这里是文章标题这里是文章标题这里是文章标题这里是文章标题这里是文章标题这里是文章标题这里是文章标题这里是文章标题这里是文章标题这里是文章标题这里是文章标题</p>
                        </div>
                        <div class="nocolor__block">
                            <span class="note__date">2019 / 2 / 1</span>
                            <a href="javascript:" class="note__option">编辑</a>
                            <a href="javascript:" class="note__option">公开</a>
                        </div>
                    </div>
                </div>
            </li>
            <li>
                <div class="set">
                    <div class="account">
                        <form id="account__form" enctype="multipart/form-data" method="post">
                            <label class="form__item">
                                <span>头像：</span>
                                <input type="file" name="head" accept="image/gif,image/jpeg,image/jpg,image/png,image/svg">
                            </label>
                            <label class="form__item">
                                <span>昵称：</span>
                                <input type="text" name="name">
                                <input type="hidden" name="id" id="form__user__id">
                                2~6个汉字字符
                            </label>
                        </form>
                        <button id="setName">修改信息</button>
                    </div>

                    <a class="show__account__set" href="javascript:">账号设置</a>
                    <div class="account__set">
                        <label class="form__item">
                            <span>旧密码：</span>
                            <input type="text">
                        </label>
                        <label class="form__item">
                            <span>新密码：</span>
                            <input type="password">
                        </label>
                        <label class="form__item">
                            <span>重复密码：</span>
                            <input type="password">
                        </label>
                        <button id="setPass">修改密码</button>
                    </div>
                </div>
            </li>
        </ul>
    </div>


    <script src="./js/jquery-3.4.1.min.js"></script>
    <script src="./js/jquerysession.js"></script>
    <script src="./js/global.js"></script>
    <script>


        !function() {
            let aPages = document.querySelectorAll(".info__pages")[0].
                       querySelectorAll("li"),
                aTab = document.querySelectorAll(".info__tab")[0].
                       querySelectorAll("li"),
                iNow = 0;
            for(let i = 0; i < aTab.length; i++) {
                aTab[i].onclick = function() {
                    aPages[iNow].classList.remove("act");
                    aTab[iNow].classList.remove("act");
                    iNow = i;
                    aPages[iNow].classList.add("act");
                    aTab[iNow].classList.add("act");
                }
            }
        }();

        $("#setPass").click(function() {
            let $aForms = $('.account__set').find('input');
            if($aForms[2].value == $aForms[1].value) {
                $.ajax({
                    type: 'POST',
                    url: "http://food.amazing-w.top/public/index/user/rePassword",
                    data: {
                        id: window.userInfo.id,
                        oldpass: $aForms[0].value,
                        newpass: $aForms[1].value
                    },
                    success: (res) => {
                        console.log(res);
                    }
                })
            }
        })

        $('#setName').click(function() {
            $('#form__user__id').attr('value', window.userInfo.id);
            let formData = new FormData($("#account__form")[0]);
            $.ajax({
                type:'post',
                url:"http://food.amazing-w.top/public/index/user/setUserInfo",
                data:formData,
                cache:false,
                contentType:false,
                processData:false,
                success:(res) =>{
                    $.ajax({
                        type: 'get',
                        url: "http://food.amazing-w.top/public/index/user/getUserInfo",
                        data: {id: window.userInfo.id},
                        success: (res) => {
                            window.userInfo = {
                                id: window.userInfo.id,
                                name: res.name,
                                sex: res.sex,
                                head: res.head
                            };
                            $('#user__head').attr('src', window.userInfo.head);
                            if($('.head__name').length) {
                                $('.head__name').text(window.userInfo.name);
                            }
                            if($('.head__img').length) {
                                $('.head__img').attr('src', window.userInfo.head);
                            }
                        }
                    })
                }
            });
        })
    </script>
</body>
</html>